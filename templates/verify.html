<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verify Product - BlockVerify</title>
<link rel="stylesheet" href="/static/css/style.css">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<!-- Navigation -->
<nav class="navbar">
<div class="nav-container">
<div class="nav-logo">
<a href="/" style="text-decoration: none; color: white;">
<h2>üîó BlockVerify</h2>
</a>
</div>
<div class="nav-menu">
<a href="/" class="nav-link">Home</a>
<a href="/verify" class="nav-link">Verify Product</a>
<a href="/login" class="nav-link">Login</a>
<a href="/signup" class="nav-link">Sign Up</a>
</div>
</div>
</nav>

<!-- Main Content -->
<main>
<div class="form-container" style="max-width: 800px;">
<!-- Page Navigation -->
<div style="margin-bottom: 2rem;">
<div style="display: flex; justify-content: center; gap: 1rem; border-bottom: 2px solid #e5e7eb; padding-bottom: 1rem;">
<button class="nav-tab active" onclick="showPage('verify-content')">üîç Single Verification</button>
<button class="nav-tab" onclick="showPage('batch-content')">üìã Batch Verification</button>
<button class="nav-tab" onclick="showPage('sample-content')">üß™ Sample Data</button>
<button class="nav-tab" onclick="showPage('stats-content')">üìä System Stats</button>
</div>
</div>

<!-- Single Verification Content -->
<div id="verify-content" class="page-content">
<h2>Verify Product Authenticity</h2>
<p style="text-align: center; color: #64748b; margin-bottom: 2rem;">
 Enter a product serial number to verify its authenticity using our blockchain system
</p>

<form id="verify-form">
<div class="form-group">
<label for="serialNumber">Product Serial Number</label>
<input type="text" id="serialNumber" name="serialNumber" required
       placeholder="Enter serial number (e.g., AAPL-IPH15-PRO-128-2024-C02XY1234)">
<small style="color: #64748b;">
 Serial numbers are case-sensitive and must match exactly
</small>
</div>
<button type="submit" class="form-submit">Verify Product</button>
</form>

<!-- Quick Test Buttons -->
<div style="margin-top: 2rem; padding: 1rem; background: #f8fafc; border-radius: 8px;">
<h4 style="margin-bottom: 1rem; color: #374151;">Quick Test Serials:</h4>
<div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
<button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem 1rem;"
        onclick="document.getElementById('serialNumber').value = 'AAPL-IPH15-PRO-128-2024-C02XY1234'">iPhone 15 Pro</button>
<button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem 1rem;"
        onclick="document.getElementById('serialNumber').value = 'SAMS-GAL-S24-256-2024-SM789012'">Galaxy S24</button>
<button class="btn btn-outline" style="font-size: 0.8rem; padding: 0.5rem 1rem;"
        onclick="document.getElementById('serialNumber').value = 'FAKE001'">Fake Device</button>
</div>
</div>

<!-- Verification Results -->
<div id="verification-result" style="margin-top: 2rem;"></div>
</div>

<!-- Batch Verification Content -->
<div id="batch-content" class="page-content" style="display: none;">
<h2>üìã Batch Verification</h2>
<p style="text-align: center; color: #64748b; margin-bottom: 2rem;">
 Verify multiple products at once (up to 10 devices)
</p>

<form id="batch-form">
<div class="form-group">
<label for="batchSerials">Serial Numbers (one per line)</label>
<textarea id="batchSerials" name="batchSerials" rows="6" required
          placeholder="Enter serial numbers, one per line:&#10;AAPL-IPH15-PRO-128-2024-C02XY1234&#10;SAMS-GAL-S24-256-2024-SM789012&#10;FAKE001"></textarea>
<small style="color: #64748b;">
 Enter up to 10 serial numbers, one per line
</small>
</div>
<button type="submit" class="form-submit">Verify Batch</button>
</form>

<!-- Batch Results -->
<div id="batch-results" style="margin-top: 2rem;"></div>
</div>

<!-- Sample Data Content -->
<div id="sample-content" class="page-content" style="display: none;">
<h2>üß™ Sample Test Data</h2>
<p style="text-align: center; color: #64748b; margin-bottom: 2rem;">
 Explore sample products in our database for testing
</p>

<button class="form-submit" onclick="loadSampleData()" style="margin-bottom: 2rem;">
üîÑ Load Sample Data
</button>

<div id="sample-data-container"></div>
</div>

<!-- Stats Content -->
<div id="stats-content" class="page-content" style="display: none;">
<h2>üìä System Statistics</h2>
<p style="text-align: center; color: #64748b; margin-bottom: 2rem;">
 Real-time verification system statistics
</p>

<button class="form-submit" onclick="loadStats()" style="margin-bottom: 2rem;">
üîÑ Refresh Statistics
</button>

<!-- Stats Dashboard -->
<div id="stats-dashboard" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
<div class="stat-card">
<div class="stat-number" id="total-devices">0</div>
<div class="stat-label">Total Devices</div>
</div>
<div class="stat-card">
<div class="stat-number" id="authenticity-rate">0%</div>
<div class="stat-label">Authenticity Rate</div>
</div>
<div class="stat-card">
<div class="stat-number" id="response-time">0ms</div>
<div class="stat-label">Avg Response Time</div>
</div>
<div class="stat-card">
<div class="stat-number" id="blockchain-devices">0</div>
<div class="stat-label">Blockchain Verified</div>
</div>
</div>
</div>

<div class="form-links">
<p><a href="/">‚Üê Back to Home</a></p>
</div>
</div>
</main>

<!-- Ownership History Modal -->
<div id="ownership-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 8px; max-width: 600px; width: 90%; max-height: 80%; overflow-y: auto;">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 1rem;">
            <h3>Ownership History</h3>
            <button onclick="closeOwnershipModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
        </div>
        <div id="ownership-content"></div>
    </div>
</div>

<style>
.nav-tab {
    background: none;
    border: none;
    padding: 0.75rem 1rem;
    cursor: pointer;
    border-radius: 6px;
    color: #64748b;
    font-weight: 500;
    transition: all 0.2s ease;
}

.nav-tab.active {
    background: #667eea;
    color: white;
}

.nav-tab:hover {
    background: #f1f5f9;
    color: #334155;
}

.nav-tab.active:hover {
    background: #5a67d8;
}

.page-content {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    text-align: center;
    border: 1px solid #e5e7eb;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #667eea;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #64748b;
    font-size: 0.9rem;
    font-weight: 500;
}

.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    color: #64748b;
}

.spinner {
    width: 30px;
    height: 30px;
    border: 3px solid #e5e7eb;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.result-card {
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1rem 0;
    border-left: 4px solid;
}

.result-authentic {
    background: rgba(34, 197, 94, 0.1);
    border-left-color: #22c55e;
}

.result-counterfeit {
    background: rgba(239, 68, 68, 0.1);
    border-left-color: #ef4444;
}

.result-not-found {
    background: rgba(156, 163, 175, 0.1);
    border-left-color: #9ca3af;
}

.device-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.detail-item {
    display: flex;
    flex-direction: column;
}

.detail-label {
    font-weight: 600;
    color: #374151;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
}

.detail-value {
    color: #6b7280;
    font-size: 0.9rem;
}

.batch-results {
    margin-top: 1rem;
}

.batch-item {
    padding: 1rem;
    margin: 0.5rem 0;
    border-radius: 6px;
    border-left: 4px solid;
}

.batch-item.authentic {
    background: rgba(34, 197, 94, 0.1);
    border-left-color: #22c55e;
}

.batch-item.counterfeit {
    background: rgba(239, 68, 68, 0.1);
    border-left-color: #ef4444;
}

.batch-item.not-found {
    background: rgba(156, 163, 175, 0.1);
    border-left-color: #9ca3af;
}

.card {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
}

.btn {
    background: #667eea;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.2s ease;
}

.btn:hover {
    background: #5a67d8;
}

.btn.secondary {
    background: #64748b;
}

.btn.secondary:hover {
    background: #475569;
}

.btn.danger {
    background: #ef4444;
}

.btn.danger:hover {
    background: #dc2626;
}

.btn-outline {
    background: transparent;
    border: 1px solid #667eea;
    color: #667eea;
}

.btn-outline:hover {
    background: #667eea;
    color: white;
}

.timeline-item {
    position: relative;
    padding-left: 2rem;
    margin-bottom: 1.5rem;
}

.timeline-marker {
    position: absolute;
    left: 0;
    top: 0.5rem;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #667eea;
}

.timeline-content {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 6px;
}
</style>

    <script>
    // Page Navigation
    function showPage(pageId) {
        // Hide all pages
        const pages = document.querySelectorAll('.page-content');
        pages.forEach(page => page.style.display = 'none');
        
        // Remove active class from all tabs
        const tabs = document.querySelectorAll('.nav-tab');
        tabs.forEach(tab => tab.classList.remove('active'));
        
        // Show selected page
        document.getElementById(pageId).style.display = 'block';
        
        // Add active class to clicked tab
        event.target.classList.add('active');
        
        // Load data if needed
        if (pageId === 'sample-content') {
            loadSampleData();
        } else if (pageId === 'stats-content') {
            loadStats();
        }
    }

    // Single Device Verification
    document.getElementById('verify-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        await verifyDevice();
    });

    async function verifyDevice() {
        const serialNumber = document.getElementById('serialNumber').value.trim();
        if (!serialNumber) {
            alert('Please enter a serial number');
            return;
        }

        const resultDiv = document.getElementById('verification-result');
        resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Verifying device...</p></div>';

        try {
            const response = await axios.get(`/verify/${encodeURIComponent(serialNumber)}`);
            const result = response.data;

            let resultClass = 'result-not-found';
            let statusIcon = '‚ùì';
            let statusText = 'Not Found';

            if (result.authentic) {
                resultClass = 'result-authentic';
                statusIcon = '‚úÖ';
                statusText = 'Authentic';
            } else if (result.status === 'not_found') {
                resultClass = 'result-not-found';
                statusIcon = '‚ùì';
                statusText = 'Not Found';
            } else {
                resultClass = 'result-counterfeit';
                statusIcon = '‚ùå';
                statusText = 'Counterfeit';
            }

            let detailsHtml = '';
            if (result.authentic || result.brand) {
                detailsHtml = `
                    <div class="device-details">
                        <div class="detail-item">
                            <div class="detail-label">Brand</div>
                            <div class="detail-value">${result.brand || 'Unknown'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Model</div>
                            <div class="detail-value">${result.model || 'Unknown'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Device Type</div>
                            <div class="detail-value">${result.deviceType || 'Unknown'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Storage</div>
                            <div class="detail-value">${result.storage || 'Unknown'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Color</div>
                            <div class="detail-value">${result.color || 'Unknown'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Manufacturer</div>
                            <div class="detail-value">${result.manufacturerName || 'Unknown'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Verification Source</div>
                            <div class="detail-value">${result.source === 'blockchain' ? 'üîó Blockchain' : 'üíæ Database'}</div>
                        </div>
                        ${result.confidence ? `
                        <div class="detail-item">
                            <div class="detail-label">Confidence</div>
                            <div class="detail-value">${result.confidence}%</div>
                        </div>` : ''}
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn secondary" onclick="showOwnershipHistory('${serialNumber}')">üìã View Ownership History</button>
                        <button class="btn secondary" onclick="getDeviceDetails('${serialNumber}')">üì± Full Details</button>
                    </div>
                `;
            }

            resultDiv.innerHTML = `
                <div class="result-card ${resultClass}">
                    <h3>${statusIcon} ${statusText}</h3>
                    <p><strong>Serial Number:</strong> ${serialNumber}</p>
                    ${result.message ? `<p>${result.message}</p>` : ''}
                    ${detailsHtml}
                </div>
            `;
        } catch (error) {
            resultDiv.innerHTML = `
                <div class="result-card result-counterfeit">
                    <h3>‚ùå Error</h3>
                    <p>Failed to verify device. Please try again.</p>
                    <p><small>Error: ${error.message}</small></p>
                </div>
            `;
        }
    }

    // Batch Verification
    document.getElementById('batch-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        await verifyBatch();
    });

    async function verifyBatch() {
        const batchText = document.getElementById('batchSerials').value.trim();
        if (!batchText) {
            alert('Please enter serial numbers');
            return;
        }

        const serialNumbers = batchText.split('\n').map(s => s.trim()).filter(s => s);
        if (serialNumbers.length === 0) {
            alert('Please enter valid serial numbers');
            return;
        }

        if (serialNumbers.length > 10) {
            alert('Maximum 10 devices per batch');
            return;
        }

        const resultDiv = document.getElementById('batch-results');
        resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Verifying devices...</p></div>';

        try {
            const response = await axios.post('/verify-batch', { serialNumbers });
            const data = response.data;
            const results = data.results;

            let html = `<h3>üìã Batch Verification Results (${results.length} devices)</h3>`;
            
            results.forEach(result => {
                let statusClass = 'not-found';
                let statusIcon = '‚ùì';
                let statusText = 'Not Found';

                if (result.authentic) {
                    statusClass = 'authentic';
                    statusIcon = '‚úÖ';
                    statusText = 'Authentic';
                } else if (result.source !== 'not_found') {
                    statusClass = 'counterfeit';
                    statusIcon = '‚ùå';
                    statusText = 'Counterfeit';
                }

                html += `
                    <div class="batch-item ${statusClass}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong>${statusIcon} ${result.serialNumber}</strong>
                            <span style="color: #666; font-size: 0.9em;">${result.source === 'blockchain' ? 'üîó Blockchain' : result.source === 'database' ? 'üíæ Database' : '‚ùì Unknown'}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 0.9em;">
                            <div><strong>Status:</strong> ${statusText}</div>
                            ${result.brand ? `<div><strong>Brand:</strong> ${result.brand}</div>` : ''}
                            ${result.model ? `<div><strong>Model:</strong> ${result.model}</div>` : ''}
                            ${result.manufacturerName ? `<div><strong>Manufacturer:</strong> ${result.manufacturerName}</div>` : ''}
                        </div>
                    </div>
                `;
            });

            resultDiv.innerHTML = `<div class="batch-results">${html}</div>`;
        } catch (error) {
            resultDiv.innerHTML = `
                <div class="result-card result-counterfeit">
                    <h3>‚ùå Batch Verification Failed</h3>
                    <p>Failed to verify devices. Please try again.</p>
                    <p><small>Error: ${error.message}</small></p>
                </div>
            `;
        }
    }

    // Load system statistics
    async function loadStats() {
        try {
            const response = await axios.get('/stats');
            const stats = response.data;
            
            document.getElementById('total-devices').textContent = stats.devices.total.toLocaleString();
            document.getElementById('authenticity-rate').textContent = stats.devices.authenticity_rate + '%';
            document.getElementById('response-time').textContent = stats.verifications.average_response_time + 'ms';
            document.getElementById('blockchain-devices').textContent = stats.devices.blockchain.toLocaleString();
        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }

    // Load sample data
    async function loadSampleData() {
        const container = document.getElementById('sample-data-container');
        container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading sample data...</p></div>';

        try {
            const response = await axios.get('/sample-data');
            const samples = response.data;

            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card" style="background: rgba(39, 174, 96, 0.1); border-left: 4px solid #27ae60;">
                        <h4>‚úÖ Authentic Devices (Blockchain)</h4>
                        <p style="margin: 10px 0; color: #666;">These devices are verified on the blockchain</p>
                        ${samples.authentic.blockchain.map(serial => `
                            <div style="background: white; padding: 10px; margin: 5px 0; border-radius: 5px; font-family: monospace;">
                                <span onclick="copyToClipboard('${serial}')" style="cursor: pointer; user-select: all;" title="Click to copy">${serial}</span>
                                <button class="btn" style="float: right; padding: 2px 8px; font-size: 12px;" onclick="quickVerify('${serial}')">üîç</button>
                            </div>
                        `).join('')}
                    </div>

                    <div class="card" style="background: rgba(52, 152, 219, 0.1); border-left: 4px solid #3498db;">
                        <h4>‚úÖ Authentic Devices (Database)</h4>
                        <p style="margin: 10px 0; color: #666;">These devices are verified via database</p>
                        ${samples.authentic.database.map(serial => `
                            <div style="background: white; padding: 10px; margin: 5px 0; border-radius: 5px; font-family: monospace;">
                                <span onclick="copyToClipboard('${serial}')" style="cursor: pointer; user-select: all;" title="Click to copy">${serial}</span>
                                <button class="btn" style="float: right; padding: 2px 8px; font-size: 12px;" onclick="quickVerify('${serial}')">üîç</button>
                            </div>
                        `).join('')}
                    </div>

                    <div class="card" style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid #e74c3c;">
                        <h4>‚ùå Counterfeit/Invalid Devices</h4>
                        <p style="margin: 10px 0; color: #666;">These serial numbers should fail verification</p>
                        ${samples.counterfeit.map(serial => `
                            <div style="background: white; padding: 10px; margin: 5px 0; border-radius: 5px; font-family: monospace;">
                                <span onclick="copyToClipboard('${serial}')" style="cursor: pointer; user-select: all;" title="Click to copy">${serial}</span>
                                <button class="btn danger" style="float: right; padding: 2px 8px; font-size: 12px;" onclick="quickVerify('${serial}')">üîç</button>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(241, 196, 15, 0.1); border-left: 4px solid #f1c40f; border-radius: 8px;">
                    <h4>üí° Testing Instructions:</h4>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><strong>Click any serial number</strong> to copy it to clipboard</li>
                        <li><strong>Click üîç button</strong> for quick verification</li>
                        <li><strong>Green cards</strong> contain authentic device serials</li>
                        <li><strong>Red card</strong> contains counterfeit/invalid serials</li>
                        <li><strong>Blockchain vs Database</strong> shows different verification methods</li>
                    </ul>
                </div>
            `;

            container.innerHTML = html;
        } catch (error) {
            container.innerHTML = `
                <div class="result-card result-counterfeit">
                    <h3>‚ùå Failed to Load Sample Data</h3>
                    <p>Please check if the backend server is running.</p>
                    <p><small>Error: ${error.message}</small></p>
                </div>
            `;
        }
    }

    // Quick verify from sample
    async function quickVerify(serialNumber) {
        document.getElementById('serialNumber').value = serialNumber;
        showPage('verify-content');
        await verifyDevice();
    }

    // Copy to clipboard
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            // Show temporary feedback
            const originalText = event.target.textContent;
            event.target.textContent = '‚úì Copied!';
            event.target.style.color = '#27ae60';
            setTimeout(() => {
                event.target.textContent = originalText;
                event.target.style.color = '';
            }, 1000);
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Serial number copied to clipboard!');
        });
    }

    // Show ownership history
    async function showOwnershipHistory(serialNumber) {
        const modal = document.getElementById('ownership-modal');
        const content = document.getElementById('ownership-content');
        
        content.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading ownership history...</p></div>';
        modal.style.display = 'block';

        try {
            const response = await axios.get(`/ownership-history/${encodeURIComponent(serialNumber)}`);
            const data = response.data;

            if (data.history && data.history.length > 0) {
                let html = `
                    <h4>üì± Device: ${serialNumber}</h4>
                    <div class="ownership-timeline">
                `;

                data.history.forEach((record, index) => {
                    const date = new Date(record.date).toLocaleDateString();
                    html += `
                        <div class="timeline-item">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h5>üìã ${record.reason}</h5>
                                <p><strong>From:</strong> ${record.from}</p>
                                <p><strong>To:</strong> ${record.to}</p>
                                <p><strong>Date:</strong> ${date}</p>
                                ${record.price > 0 ? `<p><strong>Price:</strong> ${record.price.toLocaleString()}</p>` : ''}
                                ${record.invoice ? `<p><strong>Invoice:</strong> ${record.invoice}</p>` : ''}
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
                content.innerHTML = html;
            } else {
                content.innerHTML = `
                    <div class="result-card result-not-found">
                        <h4>üìã No Ownership History</h4>
                        <p>No ownership transfers found for this device.</p>
                        <p>This device may still be with the original manufacturer.</p>
                    </div>
                `;
            }
        } catch (error) {
            content.innerHTML = `
                <div class="result-card result-counterfeit">
                    <h4>‚ùå Error Loading History</h4>
                    <p>Failed to load ownership history.</p>
                    <p><small>Error: ${error.message}</small></p>
                </div>
            `;
        }
    }

    // Get full device details
    async function getDeviceDetails(serialNumber) {
        try {
            const response = await axios.get(`/device-details/${encodeURIComponent(serialNumber)}`);
            const device = response.data;

            if (device.error) {
                alert('Device details not found');
                return;
            }

            const detailsHtml = `
                <div class="result-card result-authentic">
                    <h3>üì± Complete Device Details</h3>
                    <div class="device-details">
                        <div class="detail-item">
                            <div class="detail-label">Serial Number</div>
                            <div class="detail-value" style="font-family: monospace;">${device.serialNumber}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Brand & Model</div>
                            <div class="detail-value">${device.brand} ${device.model}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Device Type</div>
                            <div class="detail-value">${device.deviceType}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Storage & Color</div>
                            <div class="detail-value">${device.storage} - ${device.color}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Processor</div>
                            <div class="detail-value">${device.processor || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Screen Size</div>
                            <div class="detail-value">${device.screenSize || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Operating System</div>
                            <div class="detail-value">${device.operatingSystem || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Retail Price</div>
                            <div class="detail-value">${device.retailPrice ? device.retailPrice.toLocaleString() : 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Manufacturer</div>
                            <div class="detail-value">${device.manufacturer.name} (${device.manufacturer.country})</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Current Owner</div>
                            <div class="detail-value">${device.currentOwner.name} (${device.currentOwner.type})</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Manufacturing Date</div>
                            <div class="detail-value">${new Date(device.manufacturingDate).toLocaleDateString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Verification Method</div>
                            <div class="detail-value">${device.isOnBlockchain ? 'üîó Blockchain' : 'üíæ Database'}</div>
                        </div>
                    </div>
                    ${device.blockchainTxHash ? `
                    <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 8px;">
                        <strong>üîó Blockchain Transaction:</strong>
                        <code style="font-size: 0.85em; word-break: break-all;">${device.blockchainTxHash}</code>
                    </div>
                    ` : ''}
                </div>
            `;

            // Add to results area
            const resultDiv = document.getElementById('verification-result');
            resultDiv.innerHTML = detailsHtml;
        } catch (error) {
            alert('Failed to load device details: ' + error.message);
        }
    }

    // Close ownership modal
    function closeOwnershipModal() {
        document.getElementById('ownership-modal').style.display = 'none';
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Seed sample data on first load if needed
        axios.get('/seed-data').catch(() => {
            console.log('Sample data seeding failed - server might be offline');
        });
        
        // Handle Enter key in serial input
        const serialInput = document.getElementById('serialNumber');
        if (serialInput) {
            serialInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    verifyDevice();
                }
            });
        }
    });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script src="/static/js/main.js"></script>

</body>
</html>